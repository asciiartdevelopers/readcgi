(written in euc-jp-unix) -*-text-*-
$Id: TODO,v 1.10 2001/08/31 07:34:05 2ch Exp $

・思いついたことを掻く。
・荒らし厳禁(ｗ
・フォーマットは任意。

				- * -

なんてこったい、作ったばかりのサイズ0ファイルに対してmmap(2) したら、
mmap自体は成功するが、指されてるポインタの先がまったくアクセス不能だい。
1バイトでもあれば、1ページ分はアクセスできる模様。こんなときは、mmap失
敗してくれよと思う響子の語呂。
(6411)


imode対応は、漏れ的に放置気味になってるんで、どなたか落ち穂拾いお願い
するです。
(6411)


板ダイジェストには、板毎ヘッドラインの差込が必要だな…どこかに差込テキ
ストの仕様、落ちてないかしら。意図的にbbs.cgi(と思われるもの)の参照を
避けてるから…
(6411)


もうみんな知ってるとは思うけど、
M-x c-set-style linux
のスタイルが、現行のソースにいちばん合ってると
おもう。ちなみに漏れのデフォルトは gnu (鬱
(6411)
↑実は自分がそのスタイルだったり... linuxがスタイル一覧にないときは
  (c-set-style "k&r") (setq c-basic-offset 8) してもよし。
  (| --))

				- * -

【部分取得とLast-Modifiedについて】

現在、Last-Modified(以降L-M)は、.datから取得しているが、chunk取得して
いる現状にそぐわないと考える。ただ、現状では、ファイルをナメてから
L-Mを求めるのは難しそうなので…どうしよう。

(6411)

				- * -

【板ダイジェストとLast-Modifiedについて】

現在の実装では、/board/subject.txt のmtimeを返しているが、subject.txt 
はsage進行の時は更新されないと思われるので、上位n個スレでsage進行が行
われているとき、正しいものが取れなくなる可能性はある。

本来ありぬべき動作は、最新10スレのmtimeのうち、最新のものを返す
べきである。

(6411)

				- * -

【カーネル資源・プロセス資源の後始末に関して】

ちょっと行儀悪いんだけど、グローバルヒープはいちいちfree()すると、効率
悪いと思う。対話型でも常駐サービスでもないCGIは、資源の開放はみーんな
カーネルに任せてしまってもいいんではないか? と漏れ的には思う。ちなみに
プロセス終了時、malloc()した空間をfree()してるわけではない。brkした部
分を関知せず、プロセスごと捨ててるハズ。

殊にmunmap(2)は、PTE(MMUのページテーブル)の解放を伴うため、TLB(MMUのペー
ジキャッシュ)がフラッシュされる。プロセス実行中にこれを行うのは、SMPシ
ステムの場合は決して軽い処理ではない。Linux-2.2だと、SMP周りは貧弱と認
識してる。なので、mmap(2)した領域は放ったらかしにしてるのだ。

XXX 詳しくは知らないんだけど、close(2)した後は、munmap()も一緒に行われ
るんではないかな? だとしたら、read openしたfdは放置しといた方が結果的
にベターかもしれぬ。どなたか突っ込み求む。

気持ち悪いとは思うんだが、速やかに処理を終えるべきCGIと割り切って、な
るべく積極的に後始末をサボりたいんだが、どうだろう? って話題はちょっと
前にprog板にスレ立ってたような気もしたーり。

(6411)

				- * -

/*
 *  どーでもいーんですが、Cソース中、
 *  read2ch.hだけEUCですな(藁
 *  ソースのdiff取るときにちょっと悲しいことが起きてしまう。
 *  どうしよ。個人的には全部EUCにできるなら
 *  したいところではある。(6411)
 */

連絡先

6411 mailto:webmaster@psychedance.com
